/**
 * @file
 * Copyright (C) 2017 by Alen Zeinolov
 * 
 * VideoParser is a class responsible for parsing and editing 
 * the information text file where information of all videos in the database (library)
 * is stored. Information includes file path, video info, display name etc. 
 * 
 * A full list of info is listed below in order it appears in the videolist file:
 * # VIDEOLIST FILE FORMAT
 * # 0 - FILE PATH
 * # 1 - DISPLAY NAME
 * # 2 - VIDEO INFO (0 IF NONE)
 * # 3 - TAGS (0 IF NONE)
 * # 4 - PLAYLIST(0 IF NONE)
 * # 5 - THUMBNAIL PATH
 *
 * @author Alen Zeinolov
 * @version 0.1
 * @date 2017
 */

#ifndef VIDEOPARSER_H
#define VIDEOPARSER_H

#include <experimental/filesystem>
#include <fstream>
#include <list>
#include <map>
#include <set>
#include <string>

#include <QList>
#include <QListWidget>
#include <QListWidgetItem>

#include "thumbnailcreator.h"

/**
 * The default name of videolist file (by default is "videolist")
 */
#define VIDEOLIST_FILE_NAME "/videolist"

namespace fs = std::experimental::filesystem;

namespace wolfsuite {

	class VideoParser {
	public:
		/**
		 * Creates a new instance of VideoParser class.
		 * It assigns the libraryfolder variable to the file path provided.
		 * @param path to the videolist file.
		 */
		VideoParser(std::string filename);
	private:
		/**
		 * List containing supported formats that this application is allowed to identify.
		 */
		std::set<std::string> supportedFormats;
	public:
		/**
		 * Videolist text file path.
		 */
		std::string libraryfolder;
		/**
		 * List of video items to be fed into the videolist widget in the main program.
		 */
		QList<QListWidgetItem*> videolist;
		/**
		 * List of video items to be fed into the videolist widget in the main program, that comply to the user search request.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		 */
		QList<QListWidgetItem*> searchlist;
	public:
		/**
		 * Scans library folder for new files that are not registered in videolist file yet.
		 * Parses those files and writes them into the videolist file. Inserts basic information
		 * and generates thumbnail upon creation.
		 * @param name of the playlist selected.
		 */
		void scanFolder(QString playlist);
		/**
		 * Writes new videofile information at the end of the videolist file, or creates new one
		 * if not found.
		 * @param name of the playlist selected.
		 */
		void writeFile(QStringList list);
		/**
		 * Parses the videolist file again and updates the list information.
		 * Useful when some file information was changed for example.
		 * If certain playlist is specified it updates list containing only files
		 * assigned to the playlist specified.
		 * @param name of the playlist selected.
		 */
		void updateList(QString playlist);
		/**
		 * Parses the videolist file searching for videos that contain the searchString.
		 * Adds to the searchList those that do contain some info.
		 * @param search string that user has entered.
		 */
		void searchList(QString searchString);
		/**
		 * Edits the seleted video with the information that was provided.
		 * @param path of the video to edit information for.
		 * @param the new value of display name field.
		 * @param the new value of video info field.
		 * @param the new value of tags field.
		 * @param the new value of playlist field.
		 */
		void editVideo(QString path, QString name, QString info, QString tags, QString playlist);
		/**
		 * Delets the video that is specified from the videolist.
		 * @param the video file path to delete from the videolist.
		 */
		void deleteVideo(QString path);
		/**
		 * Check whether the video file provided exists in the user library folder (filesystem).
		 * @param the video file path to check.
		 * @return true if exists, false otherwise.
		 */
		bool fileExists(QString path);
		/**
		 * Check whether the video file provided exists in the videolist (text file).
		 * If helps to avoid duplicating entries in the videolist file.
		 * @param the video file path to check.
		 * @return true if exists, false otherwise.
		 */
		bool videoExists(QString path);
	};

}

#endif